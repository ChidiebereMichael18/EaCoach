<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Your Seats - EA Coach</title>
    <link rel="icon" type="image/png" href="shuttle-bus_18041583.png">
    <link rel="shortcut icon" type="image/png" href="shuttle-bus_18041583.png">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#f59e0b'
                    }
                }
            }
        }
    </script>
    <style>
        .seat {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid;
        }
        .seat:hover:not(.occupied):not(.selected) {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .seat.available {
            background-color: #10b981;
            border-color: #059669;
            color: white;
        }
        .seat.selected {
            background-color: #3b82f6;
            border-color: #2563eb;
            color: white;
        }
        .seat.occupied {
            background-color: #9ca3af;
            border-color: #6b7280;
            color: white;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .aisle {
            width: 60px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="bg-white shadow">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <a href="index.html" class="flex items-center space-x-2">
                    <img src="/icons8-bus-100.png" alt="" srcset="">
                    <span class="text-xl font-bold text-primary">EA Coach</span>
                </a>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="index.html#home" class="text-gray-600 hover:text-primary transition">Home</a>
                    <a href="routes.html" class="text-gray-600 hover:text-primary transition">Routes</a>
                    <a href="booking.html" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Book Now</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Seat Selection Area -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6">Select Your Seats</h2>
                    
                    <!-- Bus Layout -->
                    <div class="mb-6">
                        <!-- Driver Section -->
                        <div class="text-center mb-4">
                            <div class="inline-block bg-gray-200 px-6 py-2 rounded-lg">
                                <span class="text-sm font-semibold">ðŸšŒ Driver</span>
                            </div>
                        </div>

                        <!-- Seat Legend -->
                        <div class="flex justify-center gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <div class="seat available"></div>
                                <span class="text-sm">Available</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="seat selected"></div>
                                <span class="text-sm">Selected</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="seat occupied"></div>
                                <span class="text-sm">Occupied</span>
                            </div>
                        </div>

                        <!-- Seat Grid: 2x2 configuration with aisle -->
                        <div class="flex justify-center">
                            <div id="seatGrid" class="flex flex-col space-y-3">
                                <!-- Seats will be generated here by JavaScript -->
                            </div>
                        </div>

                        <!-- Back of Bus -->
                        <div class="text-center mt-4">
                            <div class="inline-block bg-gray-200 px-6 py-2 rounded-lg">
                                <span class="text-sm font-semibold">Back of Bus</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Summary Sidebar -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 sticky top-4">
                    <h3 class="text-xl font-bold mb-4">Booking Summary</h3>
                    
                    <div class="space-y-4 mb-6">
                        <div>
                            <p class="text-sm text-gray-600">Bus Company</p>
                            <p class="font-semibold" id="summaryCompany">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Bus Type</p>
                            <p class="font-semibold" id="summaryBusType">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Route</p>
                            <p class="font-semibold" id="summaryRoute">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Date</p>
                            <p class="font-semibold" id="summaryDate">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Departure</p>
                            <p class="font-semibold" id="summaryDeparture">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Arrival</p>
                            <p class="font-semibold" id="summaryArrival">-</p>
                        </div>
                        <div class="border-t pt-4">
                            <p class="text-sm text-gray-600 mb-2">Selected Seats</p>
                            <div id="selectedSeatsList" class="flex flex-wrap gap-2 mb-4">
                                <span class="text-gray-400 text-sm">No seats selected</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-semibold">Total Price:</span>
                                <span class="text-xl font-bold text-primary" id="summaryTotal">UGX 0</span>
                            </div>
                        </div>
                    </div>

                    <button 
                        id="continueBtn" 
                        class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled
                    >
                        Continue to Booking
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const from = urlParams.get('from') || 'Kampala';
        const to = urlParams.get('to') || '';
        const date = urlParams.get('date') || '';
        const busId = urlParams.get('busId') || '';

        // Bus companies for mock data
        const BUS_COMPANIES = [
            "Nile Star Buses",
            "Gateway Bus Service",
            "YnY Coaches",
            "Trinity Bus",
            "Jaguar Executive Coaches",
            "KK Coaches",
            "Mash Poa Buses"
        ];

        // Bus types
        const BUS_TYPES = ["Standard", "Executive", "Luxury", "VIP"];

        // State
        let selectedSeats = [];
        let busData = null;
        let seats = Array.from({ length: 50 }, (_, i) => ({
            seatNo: i + 1,
            occupied: Math.random() < 0.2 // 20% chance of being occupied
        }));

        // Initialize
        function init() {
            // Load or generate bus data
            loadBusData();
            
            // Generate seat grid
            generateSeatGrid();
            
            // Update summary
            updateSummary();
            
            // Setup continue button
            document.getElementById('continueBtn').addEventListener('click', proceedToBooking);
        }

        function loadBusData() {
            // Try to find trip from localStorage or generate mock data
            const savedTrips = localStorage.getItem('ea_trips');
            if (savedTrips && busId) {
                try {
                    const trips = JSON.parse(savedTrips);
                    const trip = trips.find(t => t.id === busId);
                    if (trip) {
                        busData = trip;
                        // Load seat occupancy from trip if available
                        if (trip.seats && Array.isArray(trip.seats)) {
                            seats = trip.seats.map(s => ({
                                seatNo: s.seatNo,
                                occupied: s.booked || false
                            }));
                        }
                    }
                } catch (e) {
                    console.error('Error loading trips:', e);
                }
            }
            
            // If no trip found, generate mock data
            if (!busData) {
                const companyIndex = busId ? parseInt(busId.replace(/\D/g, '')) % BUS_COMPANIES.length : Math.floor(Math.random() * BUS_COMPANIES.length);
                busData = {
                    id: busId || `bus-${Date.now()}`,
                    company: BUS_COMPANIES[companyIndex] || BUS_COMPANIES[0],
                    busType: BUS_TYPES[Math.floor(Math.random() * BUS_TYPES.length)],
                    from: from,
                    to: to,
                    date: date,
                    departureTime: '08:00',
                    arrivalTime: '14:00',
                    price: 100000 + Math.floor(Math.random() * 50000) // 100k-150k
                };
            }
            
            // Ensure seats array has all 50 seats
            if (seats.length !== 50) {
                seats = Array.from({ length: 50 }, (_, i) => {
                    const existing = seats.find(s => s.seatNo === i + 1);
                    return existing || {
                        seatNo: i + 1,
                        occupied: Math.random() < 0.2
                    };
                });
            }
        }

        function generateSeatGrid() {
            const grid = document.getElementById('seatGrid');
            grid.innerHTML = '';

            // Generate 50 seats: 25 rows with 2 seats each (left and right of aisle)
            const rows = 25;
            
            for (let row = 0; row < rows; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex items-center justify-center gap-6';
                
                // Left seat (odd numbers)
                const leftSeatNo = row * 2 + 1;
                const leftSeat = createSeatElement(leftSeatNo);
                rowDiv.appendChild(leftSeat);
                
                // Aisle indicator (visual separator)
                const aisleDiv = document.createElement('div');
                aisleDiv.className = 'w-8 flex items-center justify-center';
                aisleDiv.innerHTML = '<div class="w-1 h-8 bg-gray-300"></div>';
                rowDiv.appendChild(aisleDiv);
                
                // Right seat (even numbers)
                const rightSeatNo = row * 2 + 2;
                const rightSeat = createSeatElement(rightSeatNo);
                rowDiv.appendChild(rightSeat);
                
                grid.appendChild(rowDiv);
            }
        }

        function createSeatElement(seatNo) {
            const seat = seats.find(s => s.seatNo === seatNo);
            const seatDiv = document.createElement('div');
            seatDiv.className = 'seat';
            seatDiv.textContent = seatNo;
            seatDiv.dataset.seatNo = seatNo;
            
            if (seat.occupied) {
                seatDiv.classList.add('occupied');
            } else {
                seatDiv.classList.add('available');
            }
            
            if (!seat.occupied) {
                seatDiv.addEventListener('click', () => toggleSeat(seatNo, seatDiv));
            }
            
            return seatDiv;
        }

        function toggleSeat(seatNo, element) {
            const index = selectedSeats.indexOf(seatNo);
            
            if (index > -1) {
                // Deselect
                selectedSeats.splice(index, 1);
                element.classList.remove('selected');
                element.classList.add('available');
            } else {
                // Select
                selectedSeats.push(seatNo);
                selectedSeats.sort((a, b) => a - b);
                element.classList.remove('available');
                element.classList.add('selected');
            }
            
            updateSummary();
        }

        function updateSummary() {
            // Update bus details
            if (busData) {
                document.getElementById('summaryCompany').textContent = busData.company;
                document.getElementById('summaryBusType').textContent = busData.busType || 'Standard';
                document.getElementById('summaryRoute').textContent = `${busData.from} â†’ ${busData.to}`;
                document.getElementById('summaryDate').textContent = busData.date || '-';
                document.getElementById('summaryDeparture').textContent = busData.departureTime || '-';
                document.getElementById('summaryArrival').textContent = busData.arrivalTime || '-';
            }

            // Update selected seats
            const seatsList = document.getElementById('selectedSeatsList');
            if (selectedSeats.length > 0) {
                seatsList.innerHTML = selectedSeats.map(s => 
                    `<span class="bg-primary text-white px-2 py-1 rounded text-sm">${s}</span>`
                ).join('');
            } else {
                seatsList.innerHTML = '<span class="text-gray-400 text-sm">No seats selected</span>';
            }

            // Update total price
            const pricePerSeat = busData ? busData.price : 100000;
            const total = pricePerSeat * selectedSeats.length;
            document.getElementById('summaryTotal').textContent = `UGX ${total.toLocaleString()}`;

            // Enable/disable continue button
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.disabled = selectedSeats.length === 0;
        }

        function proceedToBooking() {
            if (selectedSeats.length === 0) {
                alert('Please select at least one seat');
                return;
            }

            // Build URL with booking data
            const params = new URLSearchParams({
                from: busData.from,
                to: busData.to,
                date: busData.date,
                busId: busData.id,
                company: busData.company,
                busType: busData.busType || 'Standard',
                departureTime: busData.departureTime,
                arrivalTime: busData.arrivalTime,
                price: busData.price,
                seats: selectedSeats.join(','),
                total: busData.price * selectedSeats.length
            });

            // Redirect to passenger details page or booking page
            window.location.href = `booking.html?${params.toString()}`;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

